#!/bin/bash

query="$*"
if [ -z "$query" ]; then
    echo "Usage: play <search term>"
    exit 1
fi

# Get the top video ID from YouTube search
video_id=$(yt-dlp "ytsearch1:${query}" --quiet --no-warnings --skip-download --print "%(id)s" | head -n 1)

if [ -z "$video_id" ]; then
    echo "No results found for \"$query\""
    exit 1
fi

url="https://www.youtube.com/watch?v=$video_id"

# Play with mpv optimized for low latency
mpv --no-video --cache=yes --cache-secs=2 --audio-buffer=0.5 --demuxer-max-bytes=5242880 --demuxer-max-back-bytes=1000000 "$url"
